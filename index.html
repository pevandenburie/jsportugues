<!DOCTYPE=html>

<html>

<head>
  <title>JsPortugues</title>
  <link rel="shortcut icon" type="image/png" href="flag_icon_pt.gif" />

  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
  <!-- jQuery library -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
  <!-- Latest compiled JavaScript -->
  <script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>


  <script src="underscore-min.js"></script>
  <!--script src="http://ajax.cdnjs.com/ajax/libs/underscore.js/1.1.4/underscore-min.js"></script-->

  <!--script src="backbone-min.js"></script-->
  <script src="backbone.js"></script>
  <!--script src="http://ajax.cdnjs.com/ajax/libs/backbone.js/0.3.3/backbone-min.js"></script-->

  <script type="text/javascript" src="verb.js" charset="UTF-8"> </script>
  <script type="text/javascript" src="imperfeito.js" charset="UTF-8"> </script>
  <script type="text/javascript" src="preterito.js" charset="UTF-8"> </script>
  <script type="text/javascript" src="presentedoconjunctivo.js" charset="UTF-8"> </script>
  <script type="text/javascript" src="imperfeitodoconjunctivo.js" charset="UTF-8"> </script>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
  <!-- <link rel="stylesheet" type="text/css" href="jsportugues.css"> </style> -->
</head>

<body>
  <div class="container">
    <div class="page-header">
      <h1>JsPortugues</h1>
    </div>
  </div>

  <div id="content" class="container">
  </div>
  <br><br>
  <h2>Exercicios:</h2>
  <a href="exo_random_preterito.html" class="btn btn-default btn-block">Preterito do Indicativo</a>
  <a href="exo_random_presentedoconjunctivo.html" class="btn btn-default btn-block">Presente do Conjunctivo</a>
  <a href="exo_random_imperfeitodoconjunctivo.html" class="btn btn-default btn-block">Imperfeito do Conjunctivo</a>

  <script>

  var ConjuguingModel = Backbone.Model.extend({

    defaults: {
      conjugued: "..."
    },

    initialize: function() {
      this.conjuguingFunc = this.conjugueNoImperfeito;
    },

    conjugueNoImperfeito: function(subject, verb) {
      console.log("conjugueNoImperfeito...");
      this.set('conjugued', subject + " " + JsPortugues.noimperfeito(subject, verb));
      this.conjuguingFunc = this.conjugueNoImperfeito;
    },

    conjugueNoPreterito: function(subject, verb) {
      this.set('conjugued', subject + " " + JsPortugues.nopreterito(subject, verb));
      this.conjuguingFunc = this.conjugueNoPreterito;
    },

    conjugueNoPresenteDoConjunctivo: function(subject, verb) {
      this.set('conjugued', subject + " " + JsPortugues.nopresentedoconjunctivo(subject, verb));
      this.conjuguingFunc = this.conjugueNoPresenteDoConjunctivo;
    },

    conjugueNoImperfeitoDoConjunctivo: function(subject, verb) {
      this.set('conjugued', subject + " " + JsPortugues.noimperfeitodoconjunctivo(subject, verb));
      this.conjuguingFunc = this.conjugueNoImperfeitoDoConjunctivo;
    }
  });
  var conjuguing = new ConjuguingModel();



  var ConjuguingView = Backbone.View.extend({
    el: "#content",

    events: {
      "keypress #verb": "onKeyPress",
      "click #noimperfeito": "conjugueNoImperfeito",
      "click #nopreterito": "conjugueNoPreterito",
      "click #nopresenteconjunctivo": "conjugueNoPresenteDoConjunctivo",
      "click #noimperfeitoconjunctivo": "conjugueNoImperfeitoDoConjunctivo",
      "change #subject": "updateLastConjuguing",
    },

    initialize: function() {
      this.conjuguingFunc = this.conjugueNoImperfeito;
      this.model.on('change', this.renderAnswer, this);
    },

    template: _.template(
      "<div class=\"row\">"+
        "<div class=\"col-xs-3\"><select class=\"col-md-4\" id=\"subject\" name=\"subject\"></select></div>"+
        "<div class=\"col-xs-9\"><input class=\"col-md-8\" type=\"text\" id=\"verb\"  autocapitalize=\"off\" autofocus></input></div>"+
      "</div>"+
      "<div class=\"row\">"+
        "<div class=\"col-xs-6 col-md-3\"><button id=\"noimperfeito\" class=\"btn btn-default btn-block\">No imperfeito</button></div>"+
        "<div class=\"col-xs-6 col-md-3\"><button id=\"nopreterito\" class=\"btn btn-default btn-block\">No preterito</button></div>"+
        "<div class=\"col-xs-6 col-md-3\"><button id=\"nopresenteconjunctivo\" class=\"btn btn-default btn-block\">No presente<br>do conjuctivo</button></div>"+
        "<div class=\"col-xs-6 col-md-3\"><button id=\"noimperfeitoconjunctivo\" class=\"btn btn-default btn-block\">No imperfeito<br>do conjuctivo</button></div>"+
      "</div>"+
      "<div id=\"translatedText\"><%=conjugued%></div>"
    ),

    render: function() {
      $(this.el).html( this.template(this.model.toJSON()) );

      // Fill the list of subjects
      var subjectList = document.getElementById('subject');
      var subjects = JsPortugues.subjects;
      var option;
      for (var i=0, l=subjects.length; i<l; i+=1) {
        option = document.createElement("option");
        option.text = subjects[i];
        option.value = subjects[i];
        subjectList.add(option);
      }

      return this;
    },

    renderAnswer: function() {
      // innerText NOT supported by firefox
      document.getElementById("translatedText").textContent = this.model.get('conjugued');
    },

    conjugueNoImperfeito: function() {
      console.log("conjugueNoImperfeito...");
      var subject = document.getElementById("subject").value;
      var verb =  document.getElementById("verb").value;
      this.model.conjugueNoImperfeito(subject, verb);
    },

    conjugueNoPreterito: function() {
      console.log("conjugueNoPreterito...");
      var subject = document.getElementById("subject").value;
      var verb =  document.getElementById("verb").value;
      this.model.conjugueNoPreterito(subject, verb);
    },

    conjugueNoPresenteDoConjunctivo: function() {
      console.log("conjugueNoPresenteDoConjunctivo...");
      var subject = document.getElementById("subject").value;
      var verb =  document.getElementById("verb").value;
      this.model.conjugueNoPresenteDoConjunctivo(subject, verb);
    },

    conjugueNoImperfeitoDoConjunctivo: function() {
      console.log("conjugueNoImperfeitoDoConjunctivo...");
      var subject = document.getElementById("subject").value;
      var verb =  document.getElementById("verb").value;
      this.model.conjugueNoImperfeitoDoConjunctivo(subject, verb);
    },

    updateLastConjuguing: function() {
      var subject = document.getElementById("subject").value;
      var verb =  document.getElementById("verb").value;
      this.model.conjuguingFunc(subject, verb);
    },

    onKeyPress: function(e) {
      if (e.which == 13 || e.keyCode == 13) {
        this.updateLastConjuguing();
        //e.preventDefault(); // http://stackoverflow.com/questions/7195844/writing-text-on-div-using-javascript
      }
    }

  });

  var conjuguingView = new ConjuguingView({model: conjuguing});
  conjuguingView.render();


/*var app = new (Backbone.Router.extend({
    routes: {
      "": "index",
      "index": "index",
      "exercices/preterito": "exo_preterito",
      "exercices/imperfeitodoconjunctivo": "exo_imperfeitodoconjunctivo",
      "exercices/presentedoconjunctivo": "exo_presentedoconjunctivo",
    },

    initialize: function() {
    },

    start: function() {
      Backbone.history.start({ pushState: true });
    },

    index: function() {},
    exo_preterito: function() {},
    exo_imperfeitodoconjunctivo: function() {},
    exo_presentedoconjunctivo: function() {},
  }))();

  $(function() {
    app.start();
  })
  */
  </script>

</body>

</html>
